{% extends 'layout.html' %}
{% load staticfiles %}

{% block breadcrumb %}
	<li class='title'>Connexions</li>

{% endblock %}


{% block content %}
	<h1><i class="fa fa-sign-in"></i> Connexions</h1>
	<div class="row">

		<div class="col-md-6">
			<div class='panel panel-default'>
				<div class='panel-heading'><i class='fa fa-bar-chart fa fa-large'></i> Depuis les 3 derniers mois<div class='panel-tools'>
						{#					<div class='btn-group'>#}
						{#						<a class='btn' href='#'>#}
						{#							<i class='fa fa-refresh'></i>#}
						{#							Refresh statics#}
						{#						</a>#}
						{#						<a class='btn' data-toggle='toolbar-tooltip' href='#' title='Toggle'>#}
						{#							<i class='fa fa-chevron-down'></i>#}
						{#						</a>#}
						{#					</div>#}
					</div>
				</div>
				<div class='panel-body'>
					<div id="months"></div>
				</div>
			</div>
		</div>


		<div class="col-md-6">
			<div class='panel panel-default'>
				<div class='panel-heading'><i class='fa fa-beer fa fa-trophy'></i> Top {{ tops|length }} des ressources en {%  now 'Y' %}</div>
				<div class='panel-body'>
				<table class="table table-condensed table-hover">
					<thead>
					<tr>
						<th></th>
						<th></th>
					</tr>
					</thead>
					<tbody>
					{% for top in tops %}
					<tr>
						<td><a href="{% url 'ressource' slug=top.ressource_slug %}">{{ top.ressource }}</a></td>
						<td>{{ top.total }}</td>
					</tr>
					{% endfor %}
					</tbody>
				</table>
				</div>
			</div>
		</div>
	</div>
{%  endblock %}


{% block js %}
<script src="{% static 'js/highcharts.js' %}"></script>
<script src="{% static 'js/highcharts-fr.js' %}"></script>

{% endblock %}


{% block script %}
	$(document).ready( function()
	{
		$('#months').highcharts({
			chart: {
				type: 'area'
			},
			credits: {
				enabled: false,
			},
			title: {
				text: 'Connexions aux ressources'
			},
			subtitle: {
				text: 'Sur les 90 derniers jours'
			},
			xAxis: {
				type: 'datetime',
			},
			yAxis: {
				allowDecimals: false,
				title: {
					text: 'Connexions'
				},
			},
			tooltip: {
				pointFormat: '<b>{point.y:,.0f}</b> connexions'
			},
			plotOptions: {
				area: {
					marker: {
						enabled: false,
						symbol: 'circle',
						radius: 2,
						states: {
							hover: {
								enabled: true
							}
						}
					}
				}
			},
			series: [{
				showInLegend: false,
				pointStart: Date.UTC({{ start.year }}, {{ start.month }} - 1, {{ start.day }}),
				pointInterval: 24 * 3600 * 1000,
				data: [{% for connexion in connexions %}{{ connexion.total}}, {% endfor %}]
			}]
		});
	});
{% endblock %}

